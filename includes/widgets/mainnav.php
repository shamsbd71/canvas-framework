<?php
/** 
 *------------------------------------------------------------------------------
 * @package       Canvas Framework for Joomla!
 *------------------------------------------------------------------------------
 * @copyright     Copyright (C) 2004-2013 ThemezArt.com. All Rights Reserved.
 * @license       GNU General Public License version 2 or later; see LICENSE.txt
 * @authors       ThemezArt, JoomlaBamboo, (contribute to this project at github 
 *                & Google group to become co-author)
 * @Google group: https://groups.google.com/forum/#!forum/canvasfw
 * @Link:         http://canvas-framework.org 
 *------------------------------------------------------------------------------
 */

//prevent direct access
defined('_JEXEC') or die;

class CANVASTemplateWidgetMainnav extends CANVASTemplateWidget{

    public $name = 'mainnav';
	public $params = null;
	public $doc = null;
	
	public function __construct($params=null)
	 {
		//parent::__construct();
		$this->params = $params;
		$this->doc = JFactory::getDocument();
	 }
	
    public function renders()
    {		JHtml::_('bootstrap.tooltip');		
		$CANVASTemplate = new CANVASTemplate();
		$path = CANVASPath::getPath('tpls/widgets/' . $this->name . '.php');
		ob_start();
			if ($path) {
				include $path;
			} else {			
			?>
				<!-- MAIN NAVIGATION -->				<div id="canvas-mainnav" class="wrap navbar navbar-default <?php echo ($this->getParam('navigation_fixed_top', '0') ? 'navbar-fixed-top' : '');  ?> canvas-mainnav">										<?php if($this->getParam('navigation_fixed_top', '0')){ ?>					<div class="container">					<?php } ?>										<!-- NAVBAR HEADER -->					<div class="navbar-header">												<?php if ($this->getParam('load_head_logo_nav', 1)) : 							// get params							$sitename  = $this->params->get('sitename');							$slogan    = $this->params->get('slogan', '');							$logotype  = $this->params->get('logotype', 'text');							$logoimage = $logotype == 'image' ? $this->params->get('logoimage', 'templates/' . CANVAS_TEMPLATE . '/images/logo.png') : '';							$logoimgsm = ($logotype == 'image' && $this->params->get('enable_logoimage_sm', 0)) ? $this->params->get('logoimage_sm', '') : false;							if (!$sitename) {								$sitename = JFactory::getConfig()->get('sitename');							}						?>						<!-- LOGO IN NAVBAR -->							<!-- LOGO -->							<div class="logo logo-<?php echo $logotype ?>">								<div class="logo-<?php echo $logotype, ($logoimgsm ? ' logo-control' : '') ?>">									<a href="<?php echo JURI::base(true) ?>" title="<?php echo strip_tags($sitename) ?>">										<?php if($logotype == 'image'): ?>											<img class="logo-img" src="<?php echo JURI::base(true) . '/' . $logoimage ?>" alt="<?php echo strip_tags($sitename) ?>" />										<?php endif ?>																				<?php if($logoimgsm) : ?>											<img class="logo-img-sm" src="<?php echo JURI::base(true) . '/' . $logoimgsm ?>" alt="<?php echo strip_tags($sitename) ?>" />										<?php endif ?>										<?php if($logotype == 'image') echo '<span class="hide-text">';?>																				<?php										if (strpos($sitename,'::') !== false) {											$sitenameTitle = explode('::',$sitename);											$sitenameTitle = $sitenameTitle[0]."<span>".$sitenameTitle[1]."</span>";										}else{											$sitenameTitle = $sitename;										}										?>										<?php echo $sitenameTitle ?>																				<?php if($logotype == 'image') echo '</span>';?>									</a>									<?php echo ($slogan ? '<span class="site-slogan">'.$slogan.'</span>' : ''); ?>								</div>							</div>							<!-- //LOGO -->						<!-- //LOGO IN NAVBAR -->						<?php endif ?>												<?php if ($this->getParam('load_head_search_nav', 1)) : ?>						<!-- HEAD SEARCH -->						<div class="head-search <?php $this->_c('head-search')?>">     						  <jdoc:include type="modules" name="<?php $this->_p('head-search') ?>" style="raw" />						</div>						<!-- //HEAD SEARCH -->						<?php endif ?>												<?php if ($this->getParam('load_head_login_nav', 1)) : ?>						<!-- HEAD SEARCH -->						<div class="head-login <?php $this->_c('login')?>">     						  <!-- login trigger modal -->							<?php 							$user = JFactory::getUser(); 							$type = (!$user->get('guest')) ? 'logout' : 'login';							?>							<button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#canvasWidget<?php echo $type; ?>">							  <i class="fa fa-sign-<?php echo ($type=='login') ? 'in' : 'out' ; ?>"></i>							</button>							<div class="modal fade" id="canvasWidgetlogin" tabindex="-1" role="dialog" aria-labelledby="canvasWidget<?php echo $type; ?>Label" aria-hidden="true">								<div class="modal-dialog">									<div class="modal-content">										<div class="modal-header">											<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>											<h4 class="modal-title" id="canvasWidget<?php echo $type; ?>Label"><?php echo JText::_('JLOGIN'); ?></h4>										</div>										<div class="modal-body">											<form class="form-horizontal" role="form" action="<?php echo JRoute::_('index.php', true); ?>" method="post">											  <div class="form-group">												<label for="inputUsername" class="col-sm-4 control-label">													<?php echo JText::_('USER_NAME') ?>													 <a class="hasTooltip" href="<?php echo JRoute::_('index.php?option=com_users&view=remind'); ?>" title="<?php echo JText::_('FORGOT_YOUR_USERNAME'); ?>">													<i class="fa fa-question-circle"></i>													</a>												</label>																								<div class="col-sm-8">												  <input type="text" name="username" class="form-control" id="inputUsername" placeholder="Username">												 												</div>											  </div>											  <div class="form-group">												<label for="inputUserPassword" class="col-sm-4 control-label"><?php echo JText::_('PASSWORD') ?>													 <a class="hasTooltip" href="<?php echo JRoute::_('index.php?option=com_users&view=reset'); ?>" title="<?php echo JText::_('FORGOT_YOUR_PASSWORD'); ?>">													<i class="fa fa-question-circle"></i>													</a>												</label>												<div class="col-sm-8">												  <input type="password" class="form-control" id="inputUserPassword" name="password" placeholder="Password">												</div>											  </div>											   <?php if (JPluginHelper::isEnabled('system', 'remember')) : ?>												  <div class="form-group">													<div class="col-sm-offset-2 col-sm-10">														<div class="checkbox">															<label>															  <input type="checkbox" name="remember" > <?php echo JText::_('REMEMBER_ME') ?>															</label>														</div>													</div>												</div>												<?php endif; ?>																								 <div class="form-group">												<div class="col-sm-offset-2 col-sm-10">												  <input type="hidden" name="option" value="com_users" />													<input type="hidden" name="task" value="user.login" />													<input type="hidden" name="return" value="<?php echo base64_encode(JRoute::_('index.php', true)); ?>" />													<?php echo JHtml::_('form.token'); ?>													<button type="submit" class="btn btn-default"><?php echo JText::_('JLOGIN') ?></button>																										  <?php 												require_once JPATH_SITE . '/components/com_users/helpers/route.php';											  $usersConfig = JComponentHelper::getParams('com_users');											  if ($usersConfig->get('allowUserRegistration')) : ?>														<a class="btn btn-default" href="<?php echo JRoute::_('index.php?option=com_users&view=registration&Itemid=' . UsersHelperRoute::getRegistrationRoute()); ?>">															<?php echo JText::_('JREGISTER'); ?> <span class="fa fa-arrow-right"></span></a>												<?php endif; ?>																																																	</div>											  </div>											</form>										</div>										<div class="modal-footer">											<button type="button" class="btn btn-default" data-dismiss="modal"><?php echo JText::_('JCLOSE'); ?></button>										</div>									</div>								</div>							</div>														<div class="modal fade" id="canvasWidgetlogout" tabindex="-1" role="dialog" aria-labelledby="canvasWidget<?php echo $type; ?>Label" aria-hidden="true">								<div class="modal-dialog">									<div class="modal-content">										<div class="modal-header">											<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>											<h4 class="modal-title" id="canvasWidget<?php echo $type; ?>Label"><?php echo JText::_('JLOGOUT'); ?></h4>										</div>										<div class="modal-body">											<form class="form-horizontal" role="form" action="<?php echo JRoute::_('index.php?option=com_users', true); ?>" method="post">												<div class="form-group">																										<div class="col-md-12 logout-button">																												<button type="submit" class="btn btn-default"><?php echo JText::_('JLOGOUT') ?></button>																												<input type="hidden" name="option" value="com_users">														<input type="hidden" name="task" value="user.logout">														<input type="hidden" name="return" value="<?php echo base64_encode(JRoute::_('index.php', true)); ?>" />														<?php echo JHtml::_('form.token'); ?>													</div>												</div>											</form>										</div>										<div class="modal-footer">											<button type="button" class="btn btn-default" data-dismiss="modal"><?php echo JText::_('JCLOSE'); ?></button>										</div>									</div>								</div>							</div>						</div>						<!-- //HEAD SEARCH -->						<?php endif ?>					</div>					<!-- //NAVBAR HEADER -->										<?php if ($this->getParam('navigation_collapse_enable', 1) && $this->getParam('responsive', 1)) : ?>						<?php JFactory::getDocument()->addScript(CANVAS_URL.'/js/nav-collapse.js'); ?>					<?php endif ?>										<!-- NAVBAR MAIN -->					<nav class="canvas-navbar navbar-collapse collapse">						<jdoc:include type="<?php echo $this->getParam('navigation_type', 'megamenu') ?>" name="<?php echo $this->getParam('mm_type', 'mainmenu') ?>" />											</nav>					<!-- //NAVBAR MAIN -->										<?php if($this->getParam('navigation_fixed_top', '0')){ ?>					</div>					<?php } ?>					
				</div>				<!-- //MAIN NAVIGATION -->
			<?php
			}
		return ob_get_clean();

    }
	function getParam($name, $default = null) {
		if (!$this->params)
			return $default;
		return $this->params->get($name, $default);
	}
	
}
